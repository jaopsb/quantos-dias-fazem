---
import Layout from "../layouts/Layout.astro";
import { Sun, Moon } from "lucide-astro";
---

<Layout
  title="Quantos Dias Fazem? - Calculadora de Diferença entre Datas"
  description="Calcule quantos dias, semanas, meses, horas, minutos e segundos fazem entre duas datas específicas. Ferramenta gratuita e fácil de usar."
>
  <main
    class="min-h-screen w-full relative overflow-hidden flex items-center justify-center"
    role="main"
    aria-label="Calculadora de diferença entre datas"
  >
    <div
      class="fixed inset-0 bg-cover bg-center bg-no-repeat z-0"
      style="background-image: url('https://images.unsplash.com/photo-1709880945165-d2208c6ad2ec?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');"role="img" aria-label="Fundo decorativo" >
    </div>

    <div class="fixed inset-0 bg-black/40 z-10"></div>

    <button
      id="dark-mode-toggle"
      type="button"
      class="fixed top-4 right-4 z-50 p-3 rounded-full bg-white/90 dark:bg-neutral-800/90 backdrop-blur-sm text-neutral-600 dark:text-neutral-400 hover:bg-white dark:hover:bg-neutral-800 shadow-lg border border-neutral-200 dark:border-neutral-700 focus:outline-none focus:ring-4 focus:ring-primary-500/30 transition-all duration-200"
      aria-label="Alternar modo escuro"
    >
      <Sun id="sun-icon" class="w-5 h-5 hidden dark:block" aria-hidden="true" />
      <Moon id="moon-icon" class="w-5 h-5 block dark:hidden" aria-hidden="true" />
    </button>

    <aside
      id="ad-sidebar-left"
      class="hidden fixed left-0 top-0 h-full w-72 z-20"
      aria-label="Área de anúncio lateral esquerda"
    >
    </aside>

    <aside
      id="ad-sidebar-right"
      class="hidden fixed right-0 top-0 h-full w-72 z-20"
      aria-label="Área de anúncio lateral direita"
    >
    </aside>

    <header
      id="ad-header"
      class="hidden fixed top-0 left-0 right-0 h-20 z-20"
      aria-label="Área de anúncio superior"
    >
    </header>

    <footer
      id="ad-footer"
      class="hidden fixed bottom-0 left-0 right-0 h-20 z-20"
      aria-label="Área de anúncio inferior"
    >
    </footer>

    <div class="relative z-30 w-full max-w-2xl mx-auto px-4 sm:px-6 lg:px-8">
      <header class="text-center mb-8">
        <h1
          class="text-5xl md:text-4xl font-bold text-white mb-4 tracking-tight drop-shadow-lg"
        >
          Quantos Dias Fazem?
        </h1>
        <p class="text-base text-white/90 drop-shadow-md">
          Calcule a diferença exata entre duas datas
        </p>
      </header>

      <div
        class="bg-white/95 dark:bg-neutral-800/95 backdrop-blur-sm rounded-md shadow-2xl p-6 md:p-8 mb-8 border border-neutral-200 dark:border-neutral-700"
      >
        <form id="date-form" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label
                for="date1"
                class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2"
              >
                Primeira Data
              </label>
              <input
                type="date"
                id="date1"
                name="date1"
                required
                class="w-full rounded-md border border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-4 py-3 text-neutral-900 dark:text-neutral-100 focus:border-primary-500 focus:ring-4 focus:ring-primary-500/20 transition duration-200"
                aria-label="Selecione a primeira data"
              />
            </div>

            <div>
              <label
                for="date2"
                class="block text-sm font-medium text-neutral-700 dark:text-neutral-300 mb-2"
              >
                Segunda Data
              </label>
              <input
                type="date"
                id="date2"
                name="date2"
                required
                class="w-full rounded-lg border border-neutral-300 dark:border-neutral-700 bg-white dark:bg-neutral-800 px-4 py-3 text-neutral-900 dark:text-neutral-100 focus:border-primary-500 focus:ring-4 focus:ring-primary-500/20 transition duration-200"
                aria-label="Selecione a segunda data"
              />
            </div>
          </div>

          <button
            type="submit"
            class="w-full bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-500/30 text-white font-semibold text-base rounded-md px-6 py-3 shadow-xl hover:shadow-2xl transform hover:scale-105 transition-all duration-200"
            aria-label="Calcular diferença entre as datas"
          >
            Quantos dias fazem?
          </button>
        </form>
      </div>

      <div id="result-container" class="hidden"></div>
    </div>
  </main>
</Layout>

<script>
  const form = document.getElementById("date-form") as HTMLFormElement;
  const resultContainer = document.getElementById(
    "result-container",
  ) as HTMLDivElement;

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const date1 = formData.get("date1") as string;
    const date2 = formData.get("date2") as string;

    if (!date1 || !date2) {
      alert("Por favor, selecione ambas as datas.");
      return;
    }

    const d1 = new Date(date1);
    const d2 = new Date(date2);

    if (isNaN(d1.getTime()) || isNaN(d2.getTime())) {
      alert("Por favor, selecione datas válidas.");
      return;
    }

    const start = d1 < d2 ? d1 : d2;
    const end = d1 < d2 ? d2 : d1;

    const diffMs = end.getTime() - start.getTime();
    const seconds = Math.floor(diffMs / 1000);
    const minutes = Math.floor(seconds / 60);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);
    const weeks = Math.floor(days / 7);
    const months = Math.floor(days / 30.44);
    const years = Math.floor(days / 365.25);

    const resultHTML = `
    <section class="bg-white/95 dark:bg-neutral-800/95 backdrop-blur-sm rounded-lg shadow-2xl p-8 border border-neutral-200 dark:border-neutral-700" role="region" aria-labelledby="result-title">
        <h2 id="result-title" class="text-xl font-bold text-neutral-800 dark:text-neutral-200 mb-6 text-center">
          Resultado do Cálculo
        </h2>
        
        <div class="space-y-4" role="list">
          <div class="flex items-center justify-between py-3 px-4 bg-primary-50 dark:bg-neutral-700/30 rounded-md border border-primary-200 dark:border-neutral-600" role="listitem" aria-label="Dias: ${days.toLocaleString('pt-BR')}">
            <div class="text-base font-semibold text-neutral-700 dark:text-neutral-300">
              Dias
            </div>
            <div class="text-3xl md:text-4xl font-bold text-primary-600 dark:text-neutral-200" aria-label="${days.toLocaleString('pt-BR')} dias">
              ${days.toLocaleString("pt-BR")}
            </div>
          </div>
          
          ${
            months > 0
              ? `
            <div class="flex items-center justify-between py-3 px-4 border-b border-neutral-200 dark:border-neutral-700" role="listitem" aria-label="${months === 1 ? 'Mês' : 'Meses'}: ${months.toLocaleString('pt-BR')}">
              <div class="text-sm font-medium text-neutral-600 dark:text-neutral-400">
                ${months === 1 ? "Mês" : "Meses"}
              </div>
              <div class="text-xl font-bold text-neutral-800 dark:text-neutral-300" aria-label="${months.toLocaleString('pt-BR')} ${months === 1 ? 'mês' : 'meses'}">
                ${months.toLocaleString("pt-BR")}
              </div>
            </div>
          `
              : ""
          }
          
          <div class="flex items-center justify-between py-3 px-4 border-b border-neutral-200 dark:border-neutral-700" role="listitem" aria-label="${weeks === 1 ? 'Semana' : 'Semanas'}: ${weeks.toLocaleString('pt-BR')}">
            <div class="text-sm font-medium text-neutral-600 dark:text-neutral-400">
              ${weeks === 1 ? "Semana" : "Semanas"}
            </div>
            <div class="text-xl font-bold text-neutral-800 dark:text-neutral-300" aria-label="${weeks.toLocaleString('pt-BR')} ${weeks === 1 ? 'semana' : 'semanas'}">
              ${weeks.toLocaleString("pt-BR")}
            </div>
          </div>
          
          <div class="flex items-center justify-between py-3 px-4 border-b border-neutral-200 dark:border-neutral-700" role="listitem" aria-label="${hours === 1 ? 'Hora' : 'Horas'}: ${hours.toLocaleString('pt-BR')}">
            <div class="text-sm font-medium text-neutral-600 dark:text-neutral-400">
              ${hours === 1 ? "Hora" : "Horas"}
            </div>
            <div class="text-xl font-bold text-neutral-800 dark:text-neutral-300" aria-label="${hours.toLocaleString('pt-BR')} ${hours === 1 ? 'hora' : 'horas'}">
              ${hours.toLocaleString("pt-BR")}
            </div>
          </div>
          
          <div class="flex items-center justify-between py-3 px-4 border-b border-neutral-200 dark:border-neutral-700" role="listitem" aria-label="${minutes === 1 ? 'Minuto' : 'Minutos'}: ${minutes.toLocaleString('pt-BR')}">
            <div class="text-sm font-medium text-neutral-600 dark:text-neutral-400">
              ${minutes === 1 ? "Minuto" : "Minutos"}
            </div>
            <div class="text-xl font-bold text-neutral-800 dark:text-neutral-300" aria-label="${minutes.toLocaleString('pt-BR')} ${minutes === 1 ? 'minuto' : 'minutos'}">
              ${minutes.toLocaleString("pt-BR")}
            </div>
          </div>
          
          <div class="flex items-center justify-between py-3 px-4" role="listitem" aria-label="${seconds === 1 ? 'Segundo' : 'Segundos'}: ${seconds.toLocaleString('pt-BR')}">
            <div class="text-sm font-medium text-neutral-600 dark:text-neutral-400">
              ${seconds === 1 ? "Segundo" : "Segundos"}
            </div>
            <div class="text-xl font-bold text-neutral-800 dark:text-neutral-300" aria-label="${seconds.toLocaleString('pt-BR')} ${seconds === 1 ? 'segundo' : 'segundos'}">
              ${seconds.toLocaleString("pt-BR")}
            </div>
          </div>
        </div>
      </section>
    `;

    resultContainer.innerHTML = resultHTML;
    resultContainer.classList.remove("hidden");
    resultContainer.setAttribute("role", "region");
    resultContainer.setAttribute("aria-live", "polite");
    resultContainer.setAttribute("aria-atomic", "true");

    resultContainer.scrollIntoView({ behavior: "smooth", block: "nearest" });
  });

  function initDarkModeToggle() {
    const toggle = document.getElementById("dark-mode-toggle");
    const html = document.documentElement;

    toggle?.addEventListener("click", () => {
      html.classList.toggle("dark");
      const isDark = html.classList.contains("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initDarkModeToggle);
  } else {
    initDarkModeToggle();
  }
</script>

<style>
  #ad-sidebar-left,
  #ad-sidebar-right,
  #ad-header,
  #ad-footer {
    display: none;
  }
</style>
